unit test

share ParameterSkippingDemo {
    
    // Method with defaults
    local calculate(a := 1, b: int = 2, c: int = 3) :: sum: int, product: int {
        ~> sum: a + b + c, product: a * b * c
    }
    
    // Another method - just returns the message
    local createMessage(name: text, greeting: text = "Hello") :: message: text {
        fullMessage := greeting + " " + name
        ~> message: fullMessage
    }
    
    // Method with required first param
    local multiply(x: int, y: int = 5) :: result: int {
        ~> result: x * y
    }
    
    // Simple greeting method
    local sayHello(name: text, volume: text = "normal") :: greeting: text {
        greeting := "Hello " + name
        ~> greeting: greeting
    }
    
    // Math method with FIRST param having default too
    local mathOp(x: int = 10, y: int = 5, operation: text = "add") :: result: int, op: text {
        // Simple implementation without if (for now)
        result := x + y  // Just use add for now
        ~> result: result, op: operation
    }
    
    local testTuples() {
    // Test if this works:
    point: (float, float) = (10.5, 20.3)
    outln("Point: " + point[0] + ", " + point[1])
}
    
    share main() {
    	testTuples()
        output "=== PARAMETER SKIPPING TEST ==="
        outln("")
        
        // Test 1: Skip middle parameter
        sum1, prod1 := [sum, product]:calculate(10, _, 30)
        outln("Test 1: calculate(10, _, 30)")
        outln("  Expected: sum=42 (10+2+30), product=600 (10*2*30)")
        outln("  Got: sum=" + sum1 + ", product=" + prod1)
        outln("")
        
        // Test 2: Skip last parameter
        sum2, prod2 := [sum, product]:calculate(5, 6, _)
        outln("Test 2: calculate(5, 6, _)")
        outln("  Expected: sum=14 (5+6+3), product=90 (5*6*3)")
        outln("  Got: sum=" + sum2 + ", product=" + prod2)
        outln("")
        
        // Test 3: Skip first parameter (has default)
        sum3, prod3 := [sum, product]:calculate(_, 4, 5)
        outln("Test 3: calculate(_, 4, 5)")
        outln("  Expected: sum=10 (1+4+5), product=20 (1*4*5)")
        outln("  Got: sum=" + sum3 + ", product=" + prod3)
        outln("")
        
        // Test 4: Message with default greeting
        msg1 := createMessage("Alice", _)
        outln("Test 4: createMessage(\"Alice\", _)")
        outln("  Expected: \"Hello Alice\"")
        outln("  Got: \"" + msg1 + "\"")
        outln("")
        
        // Test 5: Message with custom greeting
        msg2 := createMessage("Bob", "Hi")
        outln("Test 5: createMessage(\"Bob\", \"Hi\")")
        outln("  Expected: \"Hi Bob\"")
        outln("  Got: \"" + msg2 + "\"")
        outln("")
        
        // Test 6: Valid skip with default
        result := multiply(10, _)
        outln("Test 6: multiply(10, _)")
        outln("  Expected: 50 (10*5)")
        outln("  Got: " + result)
        outln("")
        
        // Test 7: Multiply with explicit value
        result2 := multiply(10, 3)
        outln("Test 7: multiply(10, 3)")
        outln("  Expected: 30 (10*3)")
        outln("  Got: " + result2)
        outln("")
        
        // Test 8: Greeting skip
        greeting := sayHello("Charlie", _)
        outln("Test 8: sayHello(\"Charlie\", _)")
        outln("  Expected: \"Hello Charlie\"")
        outln("  Got: \"" + greeting + "\"")
        outln("")
        
        // Test 9: Math operation - skip middle (now x has default 10)
        mathResult1, op1 := [result, op]:mathOp(5, _, "multiply")
        outln("Test 9: mathOp(5, _, \"multiply\")")
        outln("  Expected: result=10 (5+5), op=\"multiply\"")
        outln("  Got: result=" + mathResult1 + ", op=" + op1)
        outln("")
        
        // Test 10: Math operation - skip operation
        mathResult2, op2 := [result, op]:mathOp(20, 5, _)
        outln("Test 10: mathOp(20, 5, _)")
        outln("  Expected: result=25 (20+5), op=\"add\"")
        outln("  Got: result=" + mathResult2 + ", op=" + op2)
        outln("")
        
        // Test 11: All defaults
        sum4, prod4 := [sum, product]:calculate(_, _, _)
        outln("Test 11: calculate(_, _, _)")
        outln("  Expected: sum=6 (1+2+3), product=6 (1*2*3)")
        outln("  Got: sum=" + sum4 + ", product=" + prod4)
        outln("")
        
        // Test 12: Skip first (now has default), provide others
        mathResult3, op3 := [result, op]:mathOp(_, 8, "subtract")
        outln("Test 12: mathOp(_, 8, \"subtract\")")
        outln("  Expected: result=18 (10+8), op=\"subtract\"")
        outln("  Got: result=" + mathResult3 + ", op=" + op3)
        outln("")
        
        outln("=== ALL TESTS COMPLETE ===")
        outln("")
        outln("Summary: Parameter skipping with '_' works perfectly!")
        outln("Note: Single slot returns show as maps {key=value}")
    }
}