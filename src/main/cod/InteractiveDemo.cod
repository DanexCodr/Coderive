unit sample

use {
    lang.Sys
}

share InteractiveDemo {
    
    // Supporting both else-if and elif
    local calculate(a: int, b: int, op: text)
    :: formula: int|float, operation: text {  
        if op == "+" {
           // Separate return assignments
           ~> formula: a + b
           ~> operation: "addition"
         } else if op == "-" {
           // One line return assignments
           ~> formula: a - b, operation: "subtraction"
         } else if op == "*" {
           // implicit one line return assignments
           ~> a * b, "multiplication"
         } else if op == "/" {
           // mixed one line return assignments
           ~> formula: a / b, "division"
          } else {
           ~> 0, "unknown"
          }
    }

    // Method with single expression
    local add(a: int, b: int) ~> a + b

    local haha(a: int) :: x: int, y: int {
    	// Without '~> value' this will make a compile error
    }

    
    // Array demonstration
    local demonstrateArrays() {
        Sys.println("=== Array Demo ===")

        num1: [] = [1, 2, 3]
        
        Sys.println("Trying num1: [] = " + num1)
        
        num2: [int] = [2, 3, 4, 5, 6]
        
        Sys.println("Trying num2: [int] = " + num2)
        
                // With implicitness
        num3 := [10, 20, 30, 40, 50]
        Sys.println("Trying: num3 := " + num3)
        
        Sys.println("First element: " + num3[0])
        Sys.println("Last element: " + num3[4])

        num3[2] = 99
        Sys.println("After modification: " + num3)
    }

    // Input demonstration with ENHANCED VALIDATION
    local getUserInfo() {
        Sys.println("=== User Registration ===")
    
        Sys.println("Enter your name:")
        name := (text) input
    
        Sys.println("Enter your age:")
        age := (int) input
    
        Sys.println("Enter your height (meters):")
        height := (float) input
    
        Sys.println("Are you a student? (true/false)")
        isStudent := (bool) input
    
        // NEW: Showcasing 'all' for comprehensive validation
        if all[
            name != "",
            age >= 0, 
            age <= 120,
            height > 0.0,
            height < 3.0
       ] {
            Sys.println("")
            Sys.println("Registration Complete!")
            Sys.println("Name: " + name)
            Sys.println("Age: " + age)
            Sys.println("Height: " + height + "m")
            Sys.println("Student: " + isStudent)
        
            // NEW: Showcasing 'any' for role-based greeting
            if any[isStudent, age < 25] {
                Sys.println("Welcome young user " + name + "!")
            } else {
                Sys.println("Welcome " + name + "!")
            }
         } else {
             Sys.println("")
             Sys.println(" Registration Failed: Invalid data provided!")
         }
    }

    // Calculator with user input + VALIDATION SHOWCASE
    local interactiveCalculator() {
        Sys.println("=== Interactive Calculator ===")
    
        Sys.println("Enter first number:")
        num1 := (int) input
    
        Sys.println("Enter second number:")
        num2 := (int) input
    
        Sys.println("Enter operation (+, -, *, /):")
        op := (text) input
    
        //  NEW: Showcasing conditional chains for validation!
        if op == any["+", "-", "*", "/"] {
            result, operation := [formula, operation]:calculate(num1, num2, op)
        
            Sys.println("")
            Sys.println("Calculation Result:")
            Sys.println(num1 + " " + op + " " + num2 + " = " + result)
            Sys.println("Operation: " + operation)
        } else {
            Sys.println("")
            Sys.println("Error: '" + op + "' is not a valid operation!")
            Sys.println("Please use one of: +, -, *, /")
        }
    }
    
    // Loop demonstration with input
    share numberSeries() {
        Sys.println("=== Number Series Generator ===")
        
        Sys.println("Enter start number:")
        start := (int) input
        
        Sys.println("Enter end number:")
        end := (int) input
        
        Sys.println("Number series from " + start + " to " + end + ":")
        
        Sys.println("")
        Sys.println("=== DEFAULT STEPS (No 'by' clause) ===")
        Sys.println("Counting up naturally:")
        for i in 1 to 5 {
            Sys.println("Default step: " + i)  // 1, 2, 3, 4, 5
        }
        
        Sys.println("Counting down naturally:")
        for i in 5 to 1 {
            Sys.println("Default step: " + i)  // 5, 4, 3, 2, 1
        }
        
        Sys.println("User range - smart default:")
        for i in start to end {
            Sys.println("Smart default: " + i)  // auto +1 or -1 based on start/end
        }
        
        Sys.println("")
        Sys.println("=== BASIC STEPS ===")
        Sys.println("Enter step size:")
        steps := (int) input
        
        for i by steps in start to end {
            Sys.println("Step by " + steps + ": " + i)
        }
        
        // Operator prefixes
        for i by +1 in start to end {
            Sys.println("Step by +1: " + i)
        }
        
        // Counting down with various methods
        for i by -1 in 10 to 1 {
            Sys.println("Countdown by -1: " + i)
        }
        
        Sys.println("=== MULTIPLICATIVE STEPS ===")
        
        // Multiplicative patterns
        
        for i by *2 in 1 to 32 {
            Sys.println("Doubling: " + i)
        }
        
        exponent := 1
        powerValue := 2
        for i in 1 to 6 {
           Sys.println("Power compound: 2^" + exponent + " = " + powerValue)
           exponent = exponent + 1
           powerValue = powerValue * 2
        }
        
        for i by *+2 in start to end {
            Sys.println("Step by *+2: " + i)
        }
        
        Sys.println("")
        Sys.println("=== DIVISION STEPS ===")
        
        // Division patterns
        for i by /2 in 64 to 2 {
            Sys.println("Halving: " + i)
        }
        
        for i by /+2 in 32 to 1 {
            Sys.println("Step by /+2: " + i)
        }
        
        Sys.println("")
        Sys.println("=== PRACTICAL PATTERNS ===")
        Sys.println("Powers of 2:")
        
        exponent = 1
        for value by *2 in 2 to 64 {  // Start from 2 (2^1)
           Sys.println("2^" + exponent + " = " + value)
           exponent = exponent + 1
        }
        
        Sys.println("Countdown sequences:")
        // Natural countdown
        for count in 10 to 1 {
            Sys.println("Natural countdown: " + count)
        }
        
        // Explicit countdown
        for count by -1 in 10 to 1 {
            Sys.println("Explicit countdown: " + count)
        }
        
        grow := 1
        for i in 1 to 5 {  // Limit iterations
            Sys.println("Growing: " + grow)
        grow = grow * 2 + 1
        }
        
        Sys.println("Mixed operations:")
        for mixed in 1 to 20 {
            Sys.println("Mixed default: " + mixed)
        }
        
        for mixed by +2 in 1 to 20 {
            Sys.println("Mixed +2: " + mixed)
        }
        
        for mixed by -2 in 20 to 2 {
            Sys.println("Mixed -2: " + mixed)
        }
    }
    
    // Additional demo for edge cases
    share edgeCaseLoops() {
        Sys.println("=== Edge Case Loops ===")
        
        // Single element ranges
        Sys.println("Single element:")
        for i in 5 to 5 {
            Sys.println("Single: " + i)  // Should Sys.println: 5
        }
        
        // Zero-step ranges
        Sys.println("Zero range up:")
        for i in 0 to 0 {
            Sys.println("Zero up: " + i)  // Should Sys.println: 0
        }
        
        Sys.println("Zero range down:")
        for i in 0 to 0 {
            Sys.println("Zero down: " + i)  // Should Sys.println: 0
        }
        
        // Negative numbers
        Sys.println("Negative ranges:")
        for i in -5 to -1 {
            Sys.println("Negative up: " + i) // -5, -4, -3, -2, -1
        }
        
        for i in -1 to -5 {
            Sys.println("Negative down: " + i) // -1, -2, -3, -4, -5
        }
        
        // Large steps
        Sys.println("Large steps:")
        for i by 10 in 0 to 50 {
            Sys.println("Large step: " + i ) // 0, 10, 20, 30, 40, 50
        }
    }
    
    // Main method - program entry point
    share main() {
        output "=== CODERIVE INTERACTIVE DEMO ==="
        Sys.println("")
        
        // Demonstrate arrays
        demonstrateArrays()
        Sys.println("")
        
        // Get user information
        getUserInfo() 
        Sys.println("")
        
        // Calculator demo
        interactiveCalculator()
        Sys.println("")
        
        // Number series demo
        numberSeries()
        Sys.println("")
        
        // Edge cases
        edgeCaseLoops()
        Sys.println("")
        
        Sys.println("=== DEMO COMPLETE ===")
        Sys.println("Thank you for using Coderive!")
    }
}